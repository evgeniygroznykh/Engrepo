{% extends 'switching-report-base.html'%}

{% block title %}
Все отчёты о коммутации
{% endblock %}

{% block add_scripts %}
<script>
        $(document).ready(styleReportDescriptions).ready(expandOrCollapseVar).ready(expandOrCollapseMP)
        .ready(expandOrCollapseRec).ready(expandOrCollapseOst).ready(styleWorkTypeDivs);
</script>
{% endblock %}

{% block nav %}
<li class="nav-item active">
    <a class="nav-link" href="/switching_reports/create_switching_report">Создать отчёт о коммутации</a>
</li>
<li class="nav-item active">
    <a class="nav-link" href="/switching_reports/switching_reports">Отчёты о коммутации</a>
</li>
{% endblock %}

{%block body %}
        <form action='sw_filter_reports' method="POST">
            <div style="float: left; margin-left:50px;">
                <div>
                        <label for="sortStartTime">С</label><br>
                        <input type="datetime-local" id="sortStartTime" name="sortStartTime" placeholder="" value="">
                        <br>
                </div>
                <div>
                        <label for="sortEndTime">По</label><br>
                        <input type="datetime-local" id="sortEndTime" name="sortEndTime" placeholder="" value="">
                        <br>
                </div>
                <div>
                    <button class="btn btn-dark btn-lg" type="submit" style="margin-top: 15px;">Искать</button>
                </div>
            </div>
        </form>
        <div class="container mt-5">
            <div class="md-form mt-0">
                <form action="sw_search" method="POST">
                    <input class="form-control" type="text" placeholder="Искать" aria-label="Search" name="search_string">
                </form>
            </div>
            <br>

            <h1>Все отчёты о коммутации</h1>

            {% if switching_reports|length > 0 %}
                {% if search_string == 'empty' %}
                    {% for i in range(amount_of_days) %}
                    <div class="day-block">
                        <p id="day-date">{{ (now - time_deltas[i]).__format__('%Y-%m-%d') }}</p>
                        <hr>
                        {% for wt in work_types %}
                        <div class="work-type-block" id="{{ wt }}_{{ i }}_days_before">
                            <h2>{{ wt }}</h2>
                            {% for sw_rep in switching_reports %}
                                {% if sw_rep.date.day == (now - time_deltas[i]).day and sw_rep.work_type == wt %}
                                        <div class="report-desc-block">
                                        <h2>{{sw_rep.customer}}</h2>
                                        <p class="creation-date"><b>Дата создания:</b> {{ sw_rep.date.__format__('%Y-%m-%d %H:%M') }}</p>
                                        <table class="table table-bordered table-dark">
                                            <tr class="table-success">
                                                <th style="border-bottom: none; border-right: none;">Начало: </th>
                                                <th style="border-bottom: none; border-left: none;">{{sw_rep.start_time}}</th>
                                                <th>{{sw_rep.source}}</th>
                                                <th>{{sw_rep.reserve_source}}</th>
                                            </tr>
                                            <tr class="table-info">
                                                <th style="border-top: none; border-right: none;">Окончание:</th>
                                                <th style="border-top: none; border-left: none;">{{sw_rep.end_time}}</th>
                                                <th>{{sw_rep.destination}}</th>
                                                <th>{{sw_rep.reserve_destination}}</th>
                                            </tr>
                                        </table>
                                        <p style="display: none;">{{ sw_rep.remarks }}</p>
                                        <a class="btn btn-warning btn-lg" href="id={{ sw_rep.id }}">Подробнее..</a>
                                        </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                    <hr>
                    {% endfor %}
                {% else %}
                    <div class="day-block">
                        {% for wt in work_types %}
                        <div class="work-type-block" id="{{ wt }}_{{ i }}_days_before">
                            <h2>{{ wt }}</h2>
                            {% for sw_rep in switching_reports %}
                                {% if sw_rep.work_type == wt %}
                                        <div class="report-desc-block">
                                        <h2>{{sw_rep.customer}}</h2>
                                            <p class="creation-date"><b>Дата создания:</b> {{ sw_rep.date.__format__('%Y-%m-%d %H:%M') }}</p>
                                        <table class="table table-bordered table-dark">
                                            <tr class="table-success">
                                                <th style="border-bottom: none; border-right: none;">Начало: </th>
                                                <th style="border-bottom: none; border-left: none;">{{sw_rep.start_time}}</th>
                                                <th>{{sw_rep.source}}</th>
                                                <th>{{sw_rep.reserve_source}}</th>
                                            </tr>
                                            <tr class="table-info">
                                                <th style="border-top: none; border-right: none;">Окончание:</th>
                                                <th style="border-top: none; border-left: none;">{{sw_rep.end_time}}</th>
                                                <th>{{sw_rep.destination}}</th>
                                                <th>{{sw_rep.reserve_destination}}</th>
                                            </tr>
                                        </table>
                                        <p style="display: none;">{{ sw_rep.remarks }}</p>
                                        <a class="btn btn-warning btn-lg" href="id={{ sw_rep.id }}">Подробнее..</a>
                                        </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                    <hr>
                {% endif %}
            {% else %}
                <p>No switching reports were found in database.</p>
            {% endif %}
        </div>
{% endblock %}